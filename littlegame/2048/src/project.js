window.__require=function e(t,o,n){function c(s,r){if(!o[s]){if(!t[s]){var a=s.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!r&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+s+"'")}}var h=o[s]={exports:{}};t[s][0].call(h.exports,function(e){return c(t[s][1][e]||e)},h,h.exports,e,t,o,n)}return o[s].exports}for(var i="function"==typeof __require&&__require,s=0;s<n.length;s++)c(n[s]);return c}({Block:[function(e,t,o){"use strict";cc._RF.push(t,"58f75yJixhM0bW1hfsni7iB","Block");var n=e("utils");cc.Class({extends:cc.Component,ctor:function(){this._level=0,this.fixed=!1},properties:{level:{get:function(){return this._level},set:function(e){(e<0||e>11)&&(e=0),this._level=e,this.onLevelChange()},type:cc.Integer},atlas:{default:null,type:cc.SpriteAtlas},effect:{default:null,type:cc.Node}},onLoad:function(){this.game=cc.Canvas.instance.getComponent("Game")},onLevelChange:function(){setTimeout(function(){this.atlas&&(this.getComponent(cc.Sprite).spriteFrame=this.atlas.getSpriteFrame("b"+("00"+this._level).slice(-2)))}.bind(this),0)},levelUp:function(){return this.effect.emit("block-update",this.node.name,this._level+1),this.level=this._level+1,11==this._level&&this.game.node.emit("game-success"),1!=this._level&&this.game.node.emit("gain-score"),this._level},move:function(e){if(0==this._level)return!1;for(var t=n.b2Pos(this.node.name),o=[function(e){return{x:e.x+1,y:e.y}},function(e){return{x:e.x,y:e.y-1}},function(e){return{x:e.x-1,y:e.y}},function(e){return{x:e.x,y:e.y+1}}][e],c=this.game,i=function(e){return e.x>=0&&e.y>=0&&e.x<4&&e.y<4},s=this,r=o(t),a=!1;i(r);){var l=c.getBlockByName(n.p2Block2(r)),h=l.level;if(0!=h){if(a||h!=s._level||l.fixed)break;l.levelUp(),s.level=0,a=!0,(s=l).fixed=!0}r=o(t=r)}var u=n.p2Block2(t);return u!=s.node.name?(c.getBlockByName(u).level=s._level,s.level=0,!0):a}}),cc._RF.pop()},{utils:"utils"}],Effect:[function(e,t,o){"use strict";cc._RF.push(t,"3378bLUOhBPxKQmAv31w7KY","Effect");var n=e("utils");cc.Class({extends:cc.Component,properties:{twinkleDuration:0,twinkleScale:0,prefabEffectBlock:{default:null,type:cc.Prefab}},onLoad:function(){this.node.on("block-update",this.onBlockUpdate,this)},onDestroy:function(){this.node.off("block-update",this.onBlockUpdate,this)},newEffectBlock:function(e){var t=cc.instantiate(this.prefabEffectBlock);return t.parent=this.node,t.setPosition(n.pos2(e)),t},disposeEffectBlock:function(e){e.destroy()},onBlockUpdate:function(e,t){var o=this.newEffectBlock(e);o.getComponent("Block").level=t;var n=cc.scaleTo(this.twinkleDuration,this.twinkleScale).easing(cc.easeIn(this.twinkleDuration)),c=cc.scaleTo(this.twinkleDuration,1/this.twinkleScale).easing(cc.easeOut(this.twinkleDuration)),i=cc.callFunc(this.disposeEffectBlock,this,o);o.runAction(cc.sequence(n,c,i))},getBlockNodeByName:function(e){return this.node.getChildByName(e)},getBlockByName:function(e){return this.getBlockNodeByName(e).getComponent("Block")}}),cc._RF.pop()},{utils:"utils"}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"320e9PX8gdKtoZWzC5xJXO4","Game");var n=e("utils"),c=e("Score"),i=e("TouchManager"),s=e("LogoEvent");cc.Class({extends:cc.Component,properties:{startingPoint:0,generatingFourProbability:0,nodeBackground:{default:null,type:cc.Node},score:{default:null,type:c},touchManager:{default:null,type:i},nodeGameFinish:{default:null,type:cc.Node},nodePlay:{default:null,type:cc.Node},nodeMask:{default:null,type:cc.Node},effect:{default:null,type:cc.Node},somethingIDoNotKnowWhereItIsUsed:{default:null,type:s}},onLoad:function(){var e=this.getComponent(cc.Canvas),t=cc.view.getVisibleSize(),o=e.designResolution;t.width/t.height>o.width/o.height&&(e.fitWidth=!1,e.fitHeight=!0),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),this.node.on("game-success",this.onGameSuccess,this),this.node.on("gain-score",this.onGainScore,this),this.touchManager.roll=this.roll.bind(this)},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),this.node.off("game-success",this.onGameSuccess,this),this.node.off("gain-score",this.onGainScore,this)},gameStart:function(){n.isFinished=!1,this.somethingIDoNotKnowWhereItIsUsed.reset();for(var e=0;e<4;e++)for(var t=0;t<4;t++)this.getBlockByName(n.p2Block(e,t)).level=0;for(var o=this.startingPoint;o>0;)o-=this.newRandomBlock();this.nodeGameFinish.active=!1,this.nodePlay.x=3e3,this.nodeMask.opacity=0,this.score.reset()},gameFinish:function(e){n.isFinished=!0,this.somethingIDoNotKnowWhereItIsUsed.reset(),this.nodeGameFinish.getComponent(cc.Label).string=e,this.nodeMask.opacity=128,this.nodeGameFinish.active=!0,this.nodePlay.x=0},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY.w:case cc.macro.KEY.up:this.roll(0);break;case cc.macro.KEY.a:case cc.macro.KEY.left:this.roll(1);break;case cc.macro.KEY.s:case cc.macro.KEY.down:this.roll(2);break;case cc.macro.KEY.d:case cc.macro.KEY.right:this.roll(3)}},roll:function(e){for(var t=this,o=[function(e){return n.p2Block(2-Math.floor(e/4),e%4)},function(e){return n.p2Block(e%4,1+Math.floor(e/4))},function(e){return n.p2Block(1+Math.floor(e/4),e%4)},function(e){return n.p2Block(e%4,2-Math.floor(e/4))}],c=0;c<4;c++)for(var i=0;i<4;i++)this.getBlockByName(n.p2Block(c,i)).fixed=!1;for(var s=o[e],r=!1,a=0;a<12;a++)r=this.getBlockByName(s(a)).move(e)||r;r&&this.newRandomBlock();for(var l=function(e,o){return t.getBlockByName(n.p2Block(e,o)).level},h=0;h<4;h++)for(var u=0;u<4;u++){var f=l(h,u);if(0==f)return;if(0!=h&&f==l(h-1,u))return;if(0!=u&&f==l(h,u-1))return;if(3!=h&&f==l(h+1,u))return;if(3!=u&&f==l(h,u+1))return}this.gameFinish("Game Over!")},newRandomBlock:function(){for(var e=n.randomBlock(),t=this.getBlockByName(e);0!=t.level;)t=this.getBlockByName(n.randomBlock());var o=Math.random()>=this.generatingFourProbability?1:2;return this.effect.emit("block-new",e,o),t.level=o,o},getBlockNodeByName:function(e){return this.nodeBackground.getChildByName(e)},getBlockByName:function(e){return this.getBlockNodeByName(e).getComponent("Block")},onGameSuccess:function(){this.gameFinish("Success!")},onGainScore:function(){this.score.addScore()},start:function(){this.gameStart()}}),cc._RF.pop()},{LogoEvent:"LogoEvent",Score:"Score",TouchManager:"TouchManager",utils:"utils"}],LogoEvent:[function(e,t,o){"use strict";cc._RF.push(t,"5619dKVxi9L44Ion9wKQNmV","LogoEvent");var n=e("utils");cc.Class({extends:cc.Component,properties:{doubleClickInterval:0,lblGameFinish:{default:null,type:cc.Label}},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.game=cc.Canvas.instance.getComponent("Game"),this.reset()},onDestroy:function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},reset:function(){this.lastTouchTime=0,this.touchCount=0},onTouchEnd:function(){var e=(new Date).getTime();e-this.lastTouchTime>this.doubleClickInterval?this.touchCount=0:(this.touchCount++,this.onTouchManyTimes(this.touchCount)),this.lastTouchTime=e},onTouchManyTimes:function(e){n.isFinished?e>=3&&(this.lblGameFinish.string="2"+"3".repeat(Math.min(e-1,12))+"..."):e>=5&&this.game.getBlockByName(n.randomBlock()).levelUp()}}),cc._RF.pop()},{utils:"utils"}],Score:[function(e,t,o){"use strict";cc._RF.push(t,"00720vs5HZEeaFwHVH3cs2a","Score"),cc.Class({extends:cc.Component,properties:{score:0},addScore:function(){this.score++,this.getComponent(cc.Label).string="Score: "+this.score},reset:function(){this.score=0,this.getComponent(cc.Label).string="Score: 0"}}),cc._RF.pop()},{}],TouchManager:[function(e,t,o){"use strict";cc._RF.push(t,"5e39a40UglMqLjxVSVDNRjp","TouchManager"),cc.Class({extends:cc.Component,properties:{roll:null,touchSensitivity:0},onLoad:function(){this.registerTouch(!1)},onDestroy:function(){this.registerTouch(!0)},onTouchStart:function(e){this.touchStartPoint=e.touch.getLocation(),this.enableTouch=!0},onTouchEndOrCancel:function(e){if(this.enableTouch){var t=e.touch.getLocation(),o=t.x-this.touchStartPoint.x,n=t.y-this.touchStartPoint.y;if(Math.sqrt(o*o+n*n)>this.touchSensitivity){var c=Math.atan2(n,o)/Math.PI,i=(Math.floor((4*c+5)/2)+1)%4;this.roll(i)}this.enableTouch=!1}},onTouchMove:function(e){},registerTouch:function(e){var t=e?this.node.off.bind(this.node):this.node.on.bind(this.node);t(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),t(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t(cc.Node.EventType.TOUCH_END,this.onTouchEndOrCancel,this),t(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEndOrCancel,this)}}),cc._RF.pop()},{}],utils:[function(e,t,o){"use strict";cc._RF.push(t,"adfd2kQ3X9KKozX2hvcoR/I","utils");var n={randomBlock:function(){var e=function(){return Math.floor(4*Math.random())};return n.p2Block(e(),e())},p2Block:function(e,t){var o=["1","2","3","4"];return o[e]+o[t]},p2Block2:function(e){return n.p2Block(e.x,e.y)},b2Pos:function(e){return{x:e[0]-1,y:e[1]-1}},pos:function(e,t){return cc.v2(125*e+74,125*t+74)},pos2:function(e){return cc.v2(125*e[1]-51,125*e[0]-51)},isFinished:!1};t.exports=n,cc._RF.pop()},{}]},{},["Block","Effect","Game","LogoEvent","Score","TouchManager","utils"]);