window.__require=function e(t,o,n){function i(s,r){if(!o[s]){if(!t[s]){var a=s.split("/");if(a=a[a.length-1],!t[a]){var h="function"==typeof __require&&__require;if(!r&&h)return h(a,!0);if(c)return c(a,!0);throw new Error("Cannot find module '"+s+"'")}}var l=o[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,o,n)}return o[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({Block:[function(e,t,o){"use strict";cc._RF.push(t,"58f75yJixhM0bW1hfsni7iB","Block");var n=e("utils");cc.Class({extends:cc.Component,ctor:function(){this._level=0,this.fixed=!1},properties:{level:{get:function(){return this._level},set:function(e){(e<0||e>11)&&(e=0),this._level=e,this.onLevelChange()},type:cc.Integer},atlas:{default:null,type:cc.SpriteAtlas},game:{default:null,type:cc.Node}},onLoad:function(){},onDestroy:function(){},start:function(){},onLevelChange:function(){this.atlas&&(this.getComponent(cc.Sprite).spriteFrame=this.atlas.getSpriteFrame("b"+("00"+this._level).slice(-2)))},levelUp:function(){return this.level=this._level+1,11==this._level&&this.game.emit("game-success"),1!=this._level&&this.game.emit("gain-score"),this._level},move:function(e){if(0==this._level)return!1;for(var t=n.b2Pos(this.node.name),o=[function(e){return{x:e.x+1,y:e.y}},function(e){return{x:e.x,y:e.y-1}},function(e){return{x:e.x-1,y:e.y}},function(e){return{x:e.x,y:e.y+1}}][e],i=this.game.getComponent("Game"),c=function(e){return e.x>=0&&e.y>=0&&e.x<4&&e.y<4},s=this,r=o(t),a=!1;c(r);){var h=i.getBlockByName(n.p2Block2(r)),l=h.level;if(0!=l){if(a||l!=s._level||h.fixed)break;h.levelUp(),s.level=0,a=!0,(s=h).fixed=!0}r=o(t=r)}var u=n.p2Block2(t);return u!=s.node.name?(i.getBlockByName(u).level=s._level,s.level=0,!0):a}}),cc._RF.pop()},{utils:"utils"}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"320e9PX8gdKtoZWzC5xJXO4","Game");var n=e("utils"),i=e("Score"),c=e("TouchManager"),s=e("LogoEvent");cc.Class({extends:cc.Component,properties:{startingPoint:0,generatingFourProbability:0,nodeBackground:{default:null,type:cc.Node},score:{default:null,type:i},touchManager:{default:null,type:c},nodeGameFinish:{default:null,type:cc.Node},nodePlay:{default:null,type:cc.Node},nodeMask:{default:null,type:cc.Node},somethingIDoNotKnowWhereItIsUsed:{default:null,type:s}},onLoad:function(){var e=this.getComponent(cc.Canvas),t=cc.view.getVisibleSize(),o=e.designResolution;t.width/t.height>o.width/o.height&&(e.fitWidth=!1,e.fitHeight=!0),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),this.node.on("game-success",this.onGameSuccess,this),this.node.on("gain-score",this.onGainScore,this),this.touchManager.roll=this.roll.bind(this)},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),this.node.off("game-success",this.onGameSuccess,this),this.node.off("gain-score",this.onGainScore,this)},gameStart:function(){n.isFinished=!1,this.somethingIDoNotKnowWhereItIsUsed.reset();for(var e=0;e<4;e++)for(var t=0;t<4;t++)this.getBlockByName(n.p2Block(e,t)).level=0;for(var o=this.startingPoint;o>=0;){var i=this.getBlockByName(n.randomBlock());if(0==i.level){var c=Math.random()>=this.generatingFourProbability?1:2;i.level=c,o-=c}}this.nodeGameFinish.active=!1,this.nodePlay.x=3e3,this.nodeMask.opacity=0,this.score.reset()},gameFinish:function(e){n.isFinished=!0,this.somethingIDoNotKnowWhereItIsUsed.reset(),this.nodeGameFinish.getComponent(cc.Label).string=e,this.nodeMask.opacity=128,this.nodeGameFinish.active=!0,this.nodePlay.x=0},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY.w:case cc.macro.KEY.up:this.roll(0);break;case cc.macro.KEY.a:case cc.macro.KEY.left:this.roll(1);break;case cc.macro.KEY.s:case cc.macro.KEY.down:this.roll(2);break;case cc.macro.KEY.d:case cc.macro.KEY.right:this.roll(3)}},roll:function(e){for(var t=this,o=[function(e){return n.p2Block(2-Math.floor(e/4),e%4)},function(e){return n.p2Block(e%4,1+Math.floor(e/4))},function(e){return n.p2Block(1+Math.floor(e/4),e%4)},function(e){return n.p2Block(e%4,2-Math.floor(e/4))}],i=0;i<4;i++)for(var c=0;c<4;c++)this.getBlockByName(n.p2Block(i,c)).fixed=!1;for(var s=o[e],r=!1,a=0;a<12;a++)r=this.getBlockByName(s(a)).move(e)||r;if(r){for(var h=this.getBlockByName(n.randomBlock());0!=h.level;)h=this.getBlockByName(n.randomBlock());h.level=Math.random()>=this.generatingFourProbability?1:2}for(var l=function(e,o){return t.getBlockByName(n.p2Block(e,o)).level},u=0;u<4;u++)for(var f=0;f<4;f++){var d=l(u,f);if(0==d)return;if(0!=u&&d==l(u-1,f))return;if(0!=f&&d==l(u,f-1))return;if(3!=u&&d==l(u+1,f))return;if(3!=f&&d==l(u,f+1))return}this.gameFinish("Game Over!")},getBlockNodeByName:function(e){return this.nodeBackground.getChildByName(e)},getBlockByName:function(e){return this.getBlockNodeByName(e).getComponent("Block")},onGameSuccess:function(){this.gameFinish("Success!")},onGainScore:function(){this.score.addScore()},start:function(){this.gameStart()}}),cc._RF.pop()},{LogoEvent:"LogoEvent",Score:"Score",TouchManager:"TouchManager",utils:"utils"}],LogoEvent:[function(e,t,o){"use strict";cc._RF.push(t,"5619dKVxi9L44Ion9wKQNmV","LogoEvent");var n=e("utils");cc.Class({extends:cc.Component,properties:{doubleClickInterval:0,lblGameFinish:{default:null,type:cc.Label}},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.game=cc.Canvas.instance.getComponent("Game"),this.reset()},onDestroy:function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},reset:function(){this.lastTouchTime=0,this.touchCount=0},onTouchEnd:function(){var e=(new Date).getTime();e-this.lastTouchTime>this.doubleClickInterval?this.touchCount=0:(this.touchCount++,this.onTouchManyTimes(this.touchCount)),this.lastTouchTime=e},onTouchManyTimes:function(e){n.isFinished?e>=3&&(this.lblGameFinish.string="2"+"3".repeat(Math.min(e-1,12))+"..."):e>=5&&this.game.getBlockByName(n.randomBlock()).levelUp()}}),cc._RF.pop()},{utils:"utils"}],Score:[function(e,t,o){"use strict";cc._RF.push(t,"00720vs5HZEeaFwHVH3cs2a","Score"),cc.Class({extends:cc.Component,properties:{score:0},addScore:function(){this.score++,this.getComponent(cc.Label).string="Score: "+this.score},reset:function(){this.score=0,this.getComponent(cc.Label).string="Score: 0"}}),cc._RF.pop()},{}],TouchManager:[function(e,t,o){"use strict";cc._RF.push(t,"5e39a40UglMqLjxVSVDNRjp","TouchManager"),cc.Class({extends:cc.Component,properties:{roll:null,touchSensitivity:0},onLoad:function(){this.registerTouch(!1)},onDestroy:function(){this.registerTouch(!0)},onTouchStart:function(e){this.touchStartPoint=e.touch.getLocation(),this.enableTouch=!0},onTouchEndOrCancel:function(e){if(this.enableTouch){var t=e.touch.getLocation(),o=t.x-this.touchStartPoint.x,n=t.y-this.touchStartPoint.y;if(Math.sqrt(o*o+n*n)>this.touchSensitivity){var i=Math.atan2(n,o)/Math.PI,c=(Math.floor((4*i+5)/2)+1)%4;this.roll(c)}this.enableTouch=!1}},onTouchMove:function(e){},registerTouch:function(e){var t=e?this.node.off.bind(this.node):this.node.on.bind(this.node);t(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),t(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t(cc.Node.EventType.TOUCH_END,this.onTouchEndOrCancel,this),t(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEndOrCancel,this)}}),cc._RF.pop()},{}],utils:[function(e,t,o){"use strict";cc._RF.push(t,"adfd2kQ3X9KKozX2hvcoR/I","utils");var n={pos:function(e,t){return cc.v2(125*e-106,125*t-106)},randomBlock:function(){var e=function(){return Math.floor(4*Math.random())};return n.p2Block(e(),e())},p2Block:function(e,t){var o=["1","2","3","4"];return o[e]+o[t]},p2Block2:function(e){return n.p2Block(e.x,e.y)},b2Pos:function(e){return{x:e[0]-1,y:e[1]-1}},isFinished:!1};t.exports=n,cc._RF.pop()},{}]},{},["Block","Game","LogoEvent","Score","TouchManager","utils"]);